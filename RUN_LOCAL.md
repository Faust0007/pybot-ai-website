# Запуск Telegram бота локально

## Описание
Этот файл содержит инструкции по запуску Telegram бота для обработки уведомлений с сайта PyBot AI локально на вашем компьютере, вместо использования внешних сервисов типа Render.

## Требования
- Python 3.6 или выше
- pip (установщик пакетов Python)

## Быстрый старт

### 1. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 2. Проверка настроек Telegram
В файле `.env` должны быть установлены переменные:
```
TELEGRAM_BOT_TOKEN=ваш_токен_бота
TELEGRAM_CHAT_ID=ваш_chat_id
```

Если переменные не установлены или неправильные, проверьте настройки в разделе "Настройка Telegram" ниже.

### 3. Тест отправки в Telegram
```bash
python test_telegram.py
```

Если тест прошел успешно, вы увидите сообщение "✅ Сообщение успешно отправлено в Telegram!"

### 4. Запуск сервера
```bash
python telegram_bot_server.py
```

Сервер запустится на `http://localhost:5000` и будет принимать POST-запросы на `/api/submit`.

## Проверка работы

### Проверка состояния сервера
```bash
curl http://localhost:5000/health
```

Должен вернуть:
```json
{
  "status": "ok",
  "bot_configured": true,
  "site_url": "https://faust0007.github.io/pybot-ai-website/"
}
```

### Тест отправки заявки
```bash
curl -X POST http://localhost:5000/api/submit \
  -H "Content-Type: application/json" \
  -d '{"name": "Тест", "phone": "+7-999-123-45-67"}'
```

## Настройка Telegram

### Получение токена бота
1. Напишите боту [@BotFather](https://t.me/botfather) в Telegram
2. Используйте команду `/newbot`
3. Следуйте инструкциям для создания нового бота
4. Скопируйте токен вида `5622065192:AAH4ofn0NlCNRuUM7l7LsNWSB60N_a-QXqg`

### Получение Chat ID
1. Напишите боту [@userinfobot](https://t.me/userinfobot) в Telegram
2. Скопируйте ваш Chat ID (число вроде `1905088256`)

### Добавьте бота в чат (если нужно)
Если сообщения должны отправляться в групповой чат:
1. Добавьте бота в нужный чат
2. Дайте ему права на отправку сообщений
3. Получите Chat ID чата (может быть отрицательным числом)

### Обновление настроек
1. Откройте файл `.env`
2. Замените значения:
   ```
   TELEGRAM_BOT_TOKEN=ваш_новый_токен
   TELEGRAM_CHAT_ID=ваш_chat_id
   ```
3. Перезапустите сервер

## Использование

### Для разработки
Сервер работает локально и принимает запросы с:
- `http://localhost:8000` (ваш сайт)
- `http://127.0.0.1:8000`

### Для продакшена
При необходимости использовать в продакшене настройте reverse proxy (nginx) или используйте WSGI-сервер (gunicorn).

## Остановка сервера
Нажмите `Ctrl+C` в терминале, где запущен сервер.

## API эндпоинты

- `GET /` - Информация о сервере
- `GET /health` - Проверка работоспособности
- `POST /api/submit` - Отправка заявки (используется сайтом)

## Решение проблем

### Сервер не запускается
- Проверьте, что порт 5000 свободен
- Убедитесь, что все зависимости установлены: `pip list`

### Сообщения не приходят в Telegram
- Проверьте токен и Chat ID в `.env`
- Запустите тест: `python test_telegram.py`
- Убедитесь, что бот запущен (написали ему /start)

### CORS ошибки
- Проверьте настройки CORS в `telegram_bot_server.py`
- Добавьте нужные домены в список `ALLOWED_ORIGINS`

### Логи сервера
При запуске сервера с debug=True вы увидите подробные логи в терминале.
